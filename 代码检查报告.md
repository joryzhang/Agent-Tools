# ç”¨æˆ·ä¸­å¿ƒé¡¹ç›®ä»£ç æ£€æŸ¥æŠ¥å‘Š

**æ£€æŸ¥æ—¶é—´:** 2026-02-02  
**é¡¹ç›®:** user-center (å‰åç«¯åˆ†ç¦»é¡¹ç›®)

---

## ğŸ“Š é¡¹ç›®æ¦‚å†µ

### åç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶:** Spring Boot 2.6.13
- **æ•°æ®åº“:** MySQL (ç«¯å£ 3306, æ•°æ®åº“å jory)
- **ORM:** MyBatis-Plus 3.5.1
- **ç¼“å­˜:** Redis
- **ç«¯å£:** 5782
- **Context Path:** /api

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶:** Ant Design Pro (UmiJS 4)
- **UIåº“:** Ant Design 5.13.2
- **çŠ¶æ€ç®¡ç†:** @umijs/max
- **å¼€å‘ç«¯å£:** é»˜è®¤ 8000

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. âŒ **å‰ç«¯ä»£ç†ç«¯å£é…ç½®é”™è¯¯** (å·²ä¿®å¤)
**æ–‡ä»¶:** `myapp/config/proxy.ts`  
**é—®é¢˜:** å‰ç«¯ä»£ç†æŒ‡å‘ `http://localhost:8080`,ä½†åç«¯å®é™…è¿è¡Œåœ¨ `5782` ç«¯å£  
**ä¿®å¤:** å·²å°†ä»£ç†ç›®æ ‡æ”¹ä¸º `http://localhost:5782`

```typescript
// ä¿®å¤å‰
target: 'http://localhost:8080',

// ä¿®å¤å
target: 'http://localhost:5782',
```

### 2. âš ï¸ **è¯·æ±‚æ‹¦æˆªå™¨æ·»åŠ æµ‹è¯•Token** (å·²ä¿®å¤)
**æ–‡ä»¶:** `myapp/src/requestErrorConfig.ts`  
**é—®é¢˜:** æ‰€æœ‰è¯·æ±‚éƒ½ä¼šæ·»åŠ  `?token=123` å‚æ•°,å¯èƒ½å¹²æ‰°æ­£å¸¸è¯·æ±‚  
**ä¿®å¤:** å·²æ³¨é‡Šæ‰æµ‹è¯•ä»£ç 

```typescript
// ä¿®å¤å‰
const url = config?.url?.concat('?token = 123');
return { ...config, url };

// ä¿®å¤å
// const url = config?.url?.concat('?token = 123'); // æ³¨é‡Šæ‰æµ‹è¯•token
return { ...config }; // ç›´æ¥è¿”å›åŸé…ç½®
```

### 3. ğŸ§¹ **æœªä½¿ç”¨çš„å¯¼å…¥** (å·²ä¿®å¤)
**æ–‡ä»¶:** `src/main/java/com/jory/usercenter/controller/UserController.java`  
**é—®é¢˜:** å¯¼å…¥äº† `lombok.extern.log4j.Log4j` ä½†æœªä½¿ç”¨  
**ä¿®å¤:** å·²åˆ é™¤æœªä½¿ç”¨çš„å¯¼å…¥

---

## âš ï¸ éœ€è¦æ³¨æ„çš„é—®é¢˜

### 1. ğŸ” **å®‰å…¨é—®é¢˜ - API Key æ³„éœ²é£é™©**
**æ–‡ä»¶:** `myapp/.env.local`  
**é—®é¢˜:** OpenAI API Key ç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶ä¸­
```
REACT_APP_OPENAI_API_KEY=sk-2neH7UIMqasLNk9z2GWAWly3PkpdcvJRFNhW1QOmMwJSFLwu
```

**å»ºè®®:**
- ç¡®ä¿ `.env.local` å·²æ·»åŠ åˆ° `.gitignore`
- ä¸è¦å°†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„æ–‡ä»¶æäº¤åˆ°ä»£ç ä»“åº“
- è€ƒè™‘ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡

### 2. ğŸ”„ **å“åº”æ‹¦æˆªå™¨é€»è¾‘é‡å¤**
**æ–‡ä»¶:** `myapp/src/plugins/GlobalRequset.ts`  
**é—®é¢˜:** å“åº”æ‹¦æˆªå™¨ä¸­æœ‰å¤šä¸ªè¿”å›è¯­å¥,é€»è¾‘ä¸å¤Ÿæ¸…æ™°

```typescript
// å½“å‰ä»£ç  (ç¬¬33-52è¡Œ)
request.interceptors.response.use(async (response): Promise<any> => {
  const res = await response.clone().json();
  if (res.code === 0) {
    return res.data;  // ç¬¬ä¸€ä¸ªè¿”å›
  }
  if (res.code === 40002 || res.code === 40001) {
    const urlParams = new URL(window.location.href).searchParams;
    history.push(urlParams.get('redirect') || '/user/head');
  } else {
    return res.data;  // ç¬¬äºŒä¸ªè¿”å›
  }
  return res.data;  // ç¬¬ä¸‰ä¸ªè¿”å› (æ°¸è¿œä¸ä¼šæ‰§è¡Œåˆ°)
});
```

**å»ºè®®ä¼˜åŒ–:**
```typescript
request.interceptors.response.use(async (response): Promise<any> => {
  const res = await response.clone().json();
  
  // æœªç™»å½•æˆ–æ— æƒé™,è·³è½¬åˆ°ç™»å½•é¡µ
  if (res.code === 40002 || res.code === 40001) {
    const urlParams = new URL(window.location.href).searchParams;
    history.push(urlParams.get('redirect') || '/user/head');
    return Promise.reject(res);
  }
  
  // è¿”å›æ•°æ®
  return res.data;
});
```

### 3. ğŸ“ **ç¼ºå°‘æ—¥å¿—è®°å½•**
**æ–‡ä»¶:** `UserController.java`  
**é—®é¢˜:** è™½ç„¶å¯¼å…¥äº† `@Slf4j`,ä½†æ²¡æœ‰å®é™…ä½¿ç”¨æ—¥å¿—è®°å½•

**å»ºè®®:** åœ¨å…³é”®æ“ä½œå¤„æ·»åŠ æ—¥å¿—,ä¾‹å¦‚:
```java
@Slf4j  // æ·»åŠ æ³¨è§£
@RestController
@RequestMapping(value = "/user", method = {RequestMethod.GET, RequestMethod.POST})
public class UserController {
    
    @PostMapping("/login")
    public BaseResponse<User> userLogin(@RequestBody UserLoginRequest userLoginRequest, 
                                       HttpServletRequest httpServletRequest) {
        log.info("ç”¨æˆ·ç™»å½•è¯·æ±‚: {}", userLoginRequest.getUserAccount());
        // ... å…¶ä»–ä»£ç 
    }
}
```

### 4. ğŸ—„ï¸ **æ•°æ®åº“é…ç½®**
**æ–‡ä»¶:** `application.yml`  
**å½“å‰é…ç½®:**
```yaml
datasource:
  driver-class-name: com.mysql.cj.jdbc.Driver
  url: jdbc:mysql://localhost:3306/jory
  username: root
  password: 123456
```

**å»ºè®®:**
- ç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨ root è´¦æˆ·
- å¯†ç åº”è¯¥ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–åŠ å¯†å­˜å‚¨
- è€ƒè™‘æ·»åŠ æ•°æ®åº“è¿æ¥æ± é…ç½®

---

## âœ… é…ç½®æ­£ç¡®çš„éƒ¨åˆ†

### 1. âœ… **CORS è·¨åŸŸé…ç½®**
`WebMvcConfg.java` ä¸­çš„ CORS é…ç½®æ­£ç¡®,å…è®¸äº†å¿…è¦çš„åŸŸåå’Œæ–¹æ³•ã€‚

### 2. âœ… **MyBatis-Plus é…ç½®**
- Mapper æ‰«æé…ç½®æ­£ç¡®: `@MapperScan("com.jory.usercenter.mapper")`
- é€»è¾‘åˆ é™¤é…ç½®æ­£ç¡®

### 3. âœ… **å‰ç«¯è·¯ç”±å’Œæƒé™é…ç½®**
- `app.tsx` ä¸­çš„ç™»å½•ç™½åå•é…ç½®æ­£ç¡®
- åˆå§‹åŒ–çŠ¶æ€ç®¡ç†é…ç½®åˆç†

### 4. âœ… **TypeScript ç±»å‹å®šä¹‰**
å‰åç«¯æ•°æ®ç»“æ„å®šä¹‰æ¸…æ™°,ç±»å‹å®‰å…¨ã€‚

---

## ğŸš€ å¯åŠ¨å»ºè®®

### åç«¯å¯åŠ¨æ­¥éª¤:
1. ç¡®ä¿ MySQL æ•°æ®åº“è¿è¡Œåœ¨ 3306 ç«¯å£
2. ç¡®ä¿æ•°æ®åº“ `jory` å·²åˆ›å»º
3. å¦‚æœä½¿ç”¨ Redis,ç¡®ä¿ Redis æœåŠ¡å·²å¯åŠ¨
4. è¿è¡Œ `UserCenterApplication.java`
5. åç«¯å°†åœ¨ `http://localhost:5782/api` å¯åŠ¨

### å‰ç«¯å¯åŠ¨æ­¥éª¤:
1. è¿›å…¥ `myapp` ç›®å½•
2. è¿è¡Œ `npm install` æˆ– `yarn install` (å¦‚æœè¿˜æ²¡å®‰è£…ä¾èµ–)
3. è¿è¡Œ `npm run dev` æˆ– `yarn dev`
4. å‰ç«¯å°†åœ¨ `http://localhost:8000` å¯åŠ¨
5. API è¯·æ±‚ä¼šè‡ªåŠ¨ä»£ç†åˆ° `http://localhost:5782/api`

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

- [x] åç«¯ç«¯å£é…ç½®æ£€æŸ¥
- [x] å‰ç«¯ä»£ç†é…ç½®æ£€æŸ¥
- [x] æ•°æ®åº“è¿æ¥é…ç½®æ£€æŸ¥
- [x] CORS è·¨åŸŸé…ç½®æ£€æŸ¥
- [x] ä¾èµ–åŒ…å®Œæ•´æ€§æ£€æŸ¥
- [x] ä»£ç å¯¼å…¥æ¸…ç†
- [x] TypeScript ç±»å‹å®šä¹‰æ£€æŸ¥
- [x] è¯·æ±‚/å“åº”æ‹¦æˆªå™¨æ£€æŸ¥
- [ ] æ•°æ®åº“è¡¨ç»“æ„æ£€æŸ¥ (éœ€è¦å®é™…æ•°æ®åº“)
- [ ] Redis é…ç½®æ£€æŸ¥ (éœ€è¦ç¡®è®¤æ˜¯å¦ä½¿ç”¨)

---

## ğŸ’¡ æ€»ç»“

**ä¸»è¦é—®é¢˜å·²ä¿®å¤:**
1. âœ… å‰ç«¯ä»£ç†ç«¯å£å·²ä» 8080 ä¿®æ­£ä¸º 5782
2. âœ… è¯·æ±‚æ‹¦æˆªå™¨ä¸­çš„æµ‹è¯• token å·²æ³¨é‡Š
3. âœ… æœªä½¿ç”¨çš„å¯¼å…¥å·²æ¸…ç†

**å»ºè®®æ”¹è¿›:**
1. ä¼˜åŒ–å“åº”æ‹¦æˆªå™¨é€»è¾‘
2. æ·»åŠ æ—¥å¿—è®°å½•
3. ä¿æŠ¤æ•æ„Ÿé…ç½®ä¿¡æ¯
4. è€ƒè™‘æ·»åŠ æ›´å¤šé”™è¯¯å¤„ç†

**é¡¹ç›®æ•´ä½“çŠ¶å†µ:** è‰¯å¥½,ä¸»è¦é…ç½®æ­£ç¡®,ä¿®å¤ä¸Šè¿°é—®é¢˜ååº”è¯¥å¯ä»¥æ­£å¸¸å¯åŠ¨è¿è¡Œã€‚
